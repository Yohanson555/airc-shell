## Описание

##### Состояния:
- Авторизация
- Регистрация
- Восстановление пароля

##### Общие моменты
На форму авторизации пользоатель попадает в нескольких случаях:
- Если он не авторизован в системе
- Если он был авторизован, но его токен истек пока пользователь был неактивен (не работал на сайте)
- Пользователь "разлогинился"

Если же срок действия токена истекает в процессе работы, то пользователю будет выведеном окно о том, что срок действия токена истек и ему нужно произвести авторизацию повторно.

##### Замечания

- Возможно стоит продлевать токен автоматически в процессе работы пользователя (как это делать?)

## Авторизация

Авторизация происходит по логину и паролю, указанным при регистрации.

Только пользователь, прошедший регистрацию и подтвердивший свой e-mail может авторизоваться на сайте.

##### Поля

- `E-mail` - адрес электронной почты, указанный при регистрации 
- `Password` - пароль, указанный при регистрации
- `Remember me` - функция "Запомнить меня". Если выбрана, происходит сохранение токена авторизации и времени его жизни в локальном хрангилище, что позволит авторизоваться автоматически при повторном заходе на сайт с того же браузера. В случе, если токен устарел, пользователь будет перенаправлен на старницу регистрации. 

##### Методы API

- `api/user/login`

#### Замечания

- Если пользователь пытается авторизоваться с зарегистрированным, но неподтвержденным e-mail'ом, то он будет перенаправлен на шаг подтверждения e-mail'а

- При первом заходе на сайт должны выставляться куки, информирующие о том, что пользователь уже посещал сайт. В зависимости от этой куки должна меняться надпись с приветствием.

- Автоматическая авторизация при 'Remember me' должа происходить со всех страниц Shell'а

---

## Регистрация

Регистрация происходит в 3 шага:
1. Ввод персоналльных данных
2. Подтверждение e-mail
3. Завершение регистрации - на этом шаге пользователь может нажать кнопку перехода к работе с Shell'ом. Если этого не сделать, то пользователю придеться авторизоваться обычным способом.

#### 1. Ввод персональных данных

- Пользователю нужно заполнить все поля и принять условия использования (license agreement)
- Если поля заполнен корректно, то пользователь на указанный e-mail отправляется письмо с кодом подтверждения, а так же со ссылкой на подтверждение. Происходит переход ко второму шагу.

Все поля должны иметь соответствующие проверки "на лету":
- `E-mail`
    - Проверка на то, что введен корректный e-mail адрес
    - Проверка на то, что такой e-mail не зарегистрирован в системе
- `Password`
    - Проверять, что пароль удовлетворяет требованиям к составу пароля
- `Confirm password`
    - Проверять, что пароль соответствует паролю в поле "Password"
- `Country`
    - Обазательное поле
- `Phone number`
    - Обязательное поле
    - Можно внедрить формат (нужно ли???)
- `License agreemeng`
    - Если галочка не стоит, кнопка "Next" неактивна.
    - Так же нужно отправлять параметр `agree` на сервер и проверять, выставлена ли галочка там. На случай самых умных.
    - Должна содержать ссылку (возможно в modal окне) на соглашение.


2. Подтверждение почты

После регистрации пользоват елю на указанную почту высылается код, который он должен ввести в соответствующие поля на этом шаге.

Так же есть возможность выслать код повторно. 

Количество символов для ввода и время повторной отправки можно регулировать настройками.

`(?) Возможно стоит сохранять время отправки локально и проверять его при переходе в компонент. (по сути добавить небольшую проверку в mapStateToProps), но не overkill ли это.`

3. Завершение регистрации

На этом шаге пользователь может нажать на кнопку перехода к работе с Shell'ом. Тогда он будет авторизован с токеном, который пришёл после подтверждения почты.

Если же пользователь нажмет кнопку назад или просто обновит страницу, ему нужно будет заново пройти авторизацию.

##### Методы API

- `api/user/new` - регистрация нового пользовател. 
    Запрос:
    ```json
        {
            "email":	"test11@test.test",
            "password":	"123asdASD#@$",
            "confirm":	"123asdASD#@$",
            "country":	"RUS",
            "prefix":	"+1",
            "phone":	"9217747495",
            "agree":	true,
        }
    ```
    Ответ:
    ```json
        {
            "result":true,
            "err":[],
            "needConfirm":true,
            "token":"e38bafef55d8924b6a7ba994b56e0651",
            "tokenttl":1582625350120,
            "email":"test11@test.test"
        }
    ```

    - `result` - если `true`, то регистрация прошла успешно
    - `err` - массив ошибок.
    - `needConfirm` - если `needConfirm: true`, то после регистрации нужно будет подтвердить e-mail. Иначе будет произведен сразу переход на третий шаг.
    - `token` - токен для проверки кода. Этот токен будт передан на шаге 2 вместе с кодом, чтобы проверить подлинность запроса.
    - `tokenttl` - время жизни токена. 
    - `email` - e-mail регистрируемого

- `api/user/confirm`
    Запрос:
    ```json
    {
        "code":"1096",
        "token":"e38bafef55d8924b6a7ba994b56e0651"
    }
    ```

    Ответ:
    ```json
    {
        "result":true,
        "auth_token": "e38bafef55d8924b6a7ba994b56e0651",
        "err":[]
    }
    ```

    - `auth_token` - Токен авторизации.

##### Замечания

- Код подтверждения должен приходить на почту.
- В письме с подтверждением должна быть ссылка для подтверждения ящика

--- 

## Восстановление пароля

##### Методы API

- `api/user/forget`
- `api/user/reset`


## Задачи

- [X] Изменение надписи на странице авторизации в зависимости от того был пользователь уже на сайте или нет
- [ ] Функция - Запомнить меня, Сохранение токена авторизации в localStorage с его последующей проверкой.
- [ ] Подтверждение e-mail по ссылке. В этом случае пользователю должно вывестись сообщение о том, что все подтверждено, либо, если срок действия токена истек, сообщение об этом.
- [ ] вернуть state. На его основе делать редирект на форму авторизации если пользователь обновляет страницу.
- [X] Перетащить дизайн страницы авторизации с предыдущей формы
- [ ] Предзагрузчик в Shell
- [ ] 
- [ ] 
- [ ] 


